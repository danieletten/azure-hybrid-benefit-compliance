{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Azure Hybrid Benefit & Software Assurance Entitlement Tracker\r\n\r\nThis workbook provides visibility into Azure Hybrid Benefit (AHB) usage and Software Assurance entitlement consumption across your Azure subscriptions using Azure Resource Graph data.\r\n\r\n**Primary Use Cases:**\r\n- Track Software Assurance entitlement consumption (core-based) against available 2-core packs\r\n- Identify virtual machines eligible for Azure Hybrid Benefit that are currently using pay-as-you-go licensing\r\n- Monitor AHB enablement status across Windows Server, SQL Server, and Azure SQL Platform Services\r\n\r\n**Important Disclaimers:**\r\n- Core consumption calculations are based on VM vCore counts from Azure Resource Graph\r\n- SQL Server applies a 4-core minimum per VM as per Microsoft licensing rules\r\n- This workbook provides **indicative comparisons** based on user-provided entitlement data\r\n- Results should not be used as the sole basis for licensing compliance decisions\r\n- Licensing compliance must always be validated against official Microsoft documentation and your contractual agreements\r\n- This tool does not verify licensing eligibility, mobility rights, or contractual terms"
      },
      "name": "intro-disclaimer"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "0990e515-b647-436e-bd04-bec7baa8c612",
            "version": "KqlParameterItem/1.0",
            "name": "SqlEditionParam",
            "label": "SQL Edition",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\r\n| where type =~ \"microsoft.sqlvirtualmachine/sqlvirtualmachines\"\r\n| extend\r\n    SqlImageOffer = tostring(properties.sqlImageOffer),\r\n    SqlImageSku = tostring(properties.sqlImageSku)\r\n| extend\r\n    SqlEdition = case(\r\n        isempty(SqlImageSku) and isempty(SqlImageOffer), \"Unknown\",\r\n        strcat(SqlImageOffer, \" \", SqlImageSku)\r\n    )\r\n| distinct SqlEdition\r\n| order by SqlEdition asc\r\n",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsServerDatacenterCorePacks",
            "label": "Windows Server Datacenter 2-Core Packs (Entitlement)",
            "type": 1,
            "defaultValue": "0",
            "typeSettings": {
              "parameterType": "text",
              "placeholderText": "Enter number of 2-core packs"
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "a2b3c4d5-e6f7-8901-bcde-f23456789012",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsServerStandardCorePacks",
            "label": "Windows Server Standard 2-Core Packs (Entitlement)",
            "type": 1,
            "defaultValue": "0",
            "typeSettings": {
              "parameterType": "text",
              "placeholderText": "Enter number of 2-core packs"
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "a3b4c5d6-e7f8-9012-cdef-g34567890123",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsServerAllocationMode",
            "label": "Windows Server Allocation Mode",
            "type": 2,
            "description": "Azure cannot distinguish which VMs use Datacenter vs Standard licenses. Select how to allocate consumption.",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n  { \"value\": \"DatacenterFirst\", \"label\": \"Datacenter First (allocate to DC, then overflow to Std)\" },\r\n  { \"value\": \"StandardFirst\", \"label\": \"Standard First (allocate to Std, then overflow to DC)\" },\r\n  { \"value\": \"NoAllocation\", \"label\": \"No Allocation (informational only)\" }\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "NoAllocation"
          },
          {
            "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
            "version": "KqlParameterItem/1.0",
            "name": "SqlServerEnterpriseCorePacks",
            "label": "SQL Server Enterprise 2-Core Packs (Entitlement)",
            "type": 1,
            "defaultValue": "0",
            "typeSettings": {
              "parameterType": "text",
              "placeholderText": "Enter number of 2-core packs"
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "c3d4e5f6-g7h8-9012-cdef-g23456789012",
            "version": "KqlParameterItem/1.0",
            "name": "SqlServerStandardCorePacks",
            "label": "SQL Server Standard 2-Core Packs (Entitlement)",
            "type": 1,
            "defaultValue": "0",
            "typeSettings": {
              "parameterType": "text",
              "placeholderText": "Enter number of 2-core packs"
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters-sql-edition"
    },
    {
      "type": 1,
      "content": {
        "json": "## Total Azure Hybrid Benefit overview by workload\r\n"
      },
      "name": "header-total-overview"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type in~ (\r\n  'microsoft.compute/virtualmachines',\r\n  'microsoft.sql/servers/databases',\r\n  'microsoft.sql/managedinstances',\r\n  'microsoft.sqlvirtualmachine/sqlvirtualmachines'\r\n)\r\n| extend Workload =\r\n    case(\r\n      type =~ 'microsoft.compute/virtualmachines', 'Windows Server license on VM',\r\n      type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines', 'SQL Server license on VM',\r\n      type =~ 'microsoft.sql/servers/databases', 'Azure SQL Database license',\r\n      type =~ 'microsoft.sql/managedinstances', 'Azure SQL Managed Instance license',\r\n      'Other'\r\n    )\r\n| extend AHB_Status =\r\n    case(\r\n      type =~ 'microsoft.compute/virtualmachines'\r\n        and tostring(properties.storageProfile.osDisk.osType) =~ 'Windows'\r\n        and tostring(properties.licenseType) =~ 'Windows_Server', 'AHB enabled',\r\n      type =~ 'microsoft.compute/virtualmachines'\r\n        and tostring(properties.storageProfile.osDisk.osType) =~ 'Windows', 'AHB not enabled',\r\n      type =~ 'microsoft.sql/servers/databases'\r\n        and tostring(properties.licenseType) =~ 'BasePrice', 'AHB enabled',\r\n      type =~ 'microsoft.sql/servers/databases', 'AHB not enabled',\r\n      type =~ 'microsoft.sql/managedinstances'\r\n        and tostring(properties.licenseType) =~ 'BasePrice', 'AHB enabled',\r\n      type =~ 'microsoft.sql/managedinstances', 'AHB not enabled',\r\n      type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines'\r\n        and tostring(properties.sqlServerLicenseType) =~ 'AHUB', 'AHB enabled',\r\n      type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines'\r\n        and tostring(properties.sqlServerLicenseType) =~ 'PAYG', 'AHB not enabled',\r\n      type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines'\r\n        and isempty(tostring(properties.sqlServerLicenseType)), 'AHB unknown',\r\n      type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines', 'AHB unknown',\r\n      'Out of scope'\r\n    )\r\n| where Workload != 'Other'\r\n| where AHB_Status != 'Out of scope'\r\n| summarize\r\n    ['AHB enabled'] = countif(AHB_Status == 'AHB enabled'),\r\n    ['AHB not enabled'] = countif(AHB_Status == 'AHB not enabled'),\r\n    ['AHB unknown'] = countif(AHB_Status == 'AHB unknown')\r\nby Workload\r\n| order by Workload asc",
        "size": 3,
        "title": "Total Azure Hybrid Benefit overview by workload",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "chartSettings": {
          "showLegend": true
        }
      },
      "name": "table-total-overview"
    },
    {
      "type": 1,
      "content": {
        "json": "### Windows Server Core Consumption\r\n\r\n**Important**: Azure Resource Graph cannot distinguish between Datacenter and Standard licenses. Both use the same `licenseType = 'Windows_Server'` flag. The allocation mode you select is a **user-defined assumption** for tracking purposes only and does not reflect actual license assignments."
      },
      "name": "header-windows-allocation-disclaimer"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| extend\r\n    osType = tostring(properties.storageProfile.osDisk.osType),\r\n    licenseType = tostring(properties.licenseType),\r\n    vmSize = tostring(properties.hardwareProfile.vmSize)\r\n| where osType =~ 'Windows'\r\n| extend\r\n    vCores = toint(extract(@'_([DEFL])(\\d+)', 2, vmSize))\r\n| extend\r\n    vCores = iff(isnull(vCores) or vCores == 0, 2, vCores)\r\n| extend\r\n    CoresConsumed = iff(licenseType =~ 'Windows_Server', vCores, 0)\r\n| summarize\r\n    TotalCoresConsumed = sum(CoresConsumed),\r\n    AHB_VMs = countif(licenseType =~ 'Windows_Server'),\r\n    PAYG_VMs = countif(licenseType !~ 'Windows_Server')\r\n| extend\r\n    DcCorePacks = tolong(iff(isempty('{WindowsServerDatacenterCorePacks}'), '0', '{WindowsServerDatacenterCorePacks}')),\r\n    StdCorePacks = tolong(iff(isempty('{WindowsServerStandardCorePacks}'), '0', '{WindowsServerStandardCorePacks}')),\r\n    AllocationMode = '{WindowsServerAllocationMode}'\r\n| extend\r\n    DcCoresAvail = DcCorePacks * 2,\r\n    StdCoresAvail = StdCorePacks * 2\r\n| extend\r\n    DcUsed = case(\r\n        AllocationMode == 'DatacenterFirst', iff(TotalCoresConsumed <= DcCoresAvail, TotalCoresConsumed, DcCoresAvail),\r\n        AllocationMode == 'StandardFirst', iff(TotalCoresConsumed <= StdCoresAvail, 0, TotalCoresConsumed - StdCoresAvail),\r\n        AllocationMode == 'NoAllocation', tolong(0),\r\n        tolong(0)\r\n    ),\r\n    StdUsed = case(\r\n        AllocationMode == 'StandardFirst', iff(TotalCoresConsumed <= StdCoresAvail, TotalCoresConsumed, StdCoresAvail),\r\n        AllocationMode == 'DatacenterFirst', iff(TotalCoresConsumed <= DcCoresAvail, 0, TotalCoresConsumed - DcCoresAvail),\r\n        AllocationMode == 'NoAllocation', tolong(0),\r\n        tolong(0)\r\n    )\r\n| extend\r\n    DcRemain = DcCoresAvail - DcUsed,\r\n    StdRemain = StdCoresAvail - StdUsed\r\n| extend\r\n    DcStatus = case(\r\n        AllocationMode == 'NoAllocation', 'Allocation required',\r\n        DcCoresAvail == 0, 'Not configured',\r\n        DcUsed > DcCoresAvail, 'Exceeds entitlement',\r\n        'Within entitlement'\r\n    ),\r\n    StdStatus = case(\r\n        AllocationMode == 'NoAllocation', 'Allocation required',\r\n        StdCoresAvail == 0, 'Not configured',\r\n        StdUsed > StdCoresAvail, 'Exceeds entitlement',\r\n        'Within entitlement'\r\n    )\r\n| project\r\n    ['Total Cores Consumed'] = TotalCoresConsumed,\r\n    ['DC Packs'] = DcCorePacks,\r\n    ['DC Avail'] = DcCoresAvail,\r\n    ['DC Used'] = DcUsed,\r\n    ['DC Remain'] = DcRemain,\r\n    ['DC Status'] = DcStatus,\r\n    ['Std Packs'] = StdCorePacks,\r\n    ['Std Avail'] = StdCoresAvail,\r\n    ['Std Used'] = StdUsed,\r\n    ['Std Remain'] = StdRemain,\r\n    ['Std Status'] = StdStatus,\r\n    ['AHB VMs'] = AHB_VMs,\r\n    ['PAYG VMs'] = PAYG_VMs",
        "size": 3,
        "title": "Windows Server Core Consumption by License Pool (User-Allocated)",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Quota Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Over quota",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Within quota",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "info",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "WindowsServerDatacenterCorePacks",
        "comparison": "isNotEqualTo",
        "value": "0"
      },
      "name": "table-windows-core-utilization"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines'\r\n| extend\r\n    VmResourceId = tolower(tostring(properties.virtualMachineResourceId)),\r\n    SqlServerLicenseType = tostring(properties.sqlServerLicenseType),\r\n    SqlImageOffer = tostring(properties.sqlImageOffer),\r\n    SqlImageSku = tostring(properties.sqlImageSku)\r\n| extend\r\n    SqlEdition = iff(isempty(SqlImageSku) and isempty(SqlImageOffer), 'Unknown', strcat(SqlImageOffer, ' ', SqlImageSku))\r\n| where SqlEdition in ({SqlEditionParam})\r\n| join kind=leftouter (\r\n    Resources\r\n    | where type =~ 'microsoft.compute/virtualmachines'\r\n    | extend vmSize = tostring(properties.hardwareProfile.vmSize)\r\n    | extend vCores = toint(extract('_[DEFL](\\\\d+)', 1, vmSize))\r\n    | extend vCores = iff(isnull(vCores) or vCores == 0, 2, vCores)\r\n    | project VmId = tolower(id), vCores\r\n) on $left.VmResourceId == $right.VmId\r\n| extend EffectiveCores = iff(vCores < 4, 4, vCores)\r\n| extend EffectiveCores = iff(isnull(EffectiveCores), 4, EffectiveCores)\r\n| extend\r\n    IsEnterprise = iff(SqlImageOffer contains 'Enterprise' or SqlImageSku contains 'Enterprise', 1, 0),\r\n    IsStandard = iff(SqlImageOffer contains 'Standard' or SqlImageSku contains 'Standard', 1, 0),\r\n    IsAHB = iff(SqlServerLicenseType =~ 'AHUB', 1, 0)\r\n| summarize\r\n    EnterpriseCores = sumif(EffectiveCores, IsAHB == 1 and (IsEnterprise == 1 or (IsEnterprise == 0 and IsStandard == 0))),\r\n    StandardCores = sumif(EffectiveCores, IsAHB == 1 and IsStandard == 1 and IsEnterprise == 0),\r\n    AHB_VMs = dcountif(VmResourceId, IsAHB == 1),\r\n    PAYG_VMs = dcountif(VmResourceId, SqlServerLicenseType =~ 'PAYG'),\r\n    Unknown_VMs = dcountif(VmResourceId, isempty(SqlServerLicenseType))\r\n| extend\r\n    EntCorePacks = tolong(iff(isempty('{SqlServerEnterpriseCorePacks}'), '0', '{SqlServerEnterpriseCorePacks}')),\r\n    StdCorePacks = tolong(iff(isempty('{SqlServerStandardCorePacks}'), '0', '{SqlServerStandardCorePacks}'))\r\n| extend\r\n    EntCoresAvail = EntCorePacks * 2,\r\n    StdCoresAvail = StdCorePacks * 2\r\n| extend\r\n    EntCoresRem = EntCoresAvail - EnterpriseCores,\r\n    StdCoresRem = StdCoresAvail - StandardCores\r\n| extend\r\n    EntStatus = iff(EntCoresAvail == 0, 'ℹ️ Not configured', iff(EnterpriseCores > EntCoresAvail, '⚠️ Exceeds entitlement', '✅ Within entitlement')),\r\n    StdStatus = iff(StdCoresAvail == 0, 'ℹ️ Not configured', iff(StandardCores > StdCoresAvail, '⚠️ Exceeds entitlement', '✅ Within entitlement'))\r\n| project\r\n    ['Ent Packs'] = EntCorePacks,\r\n    ['Ent Avail'] = EntCoresAvail,\r\n    ['Ent Used'] = EnterpriseCores,\r\n    ['Ent Remain'] = EntCoresRem,\r\n    ['Ent Status'] = EntStatus,\r\n    ['Std Packs'] = StdCorePacks,\r\n    ['Std Avail'] = StdCoresAvail,\r\n    ['Std Used'] = StandardCores,\r\n    ['Std Remain'] = StdCoresRem,\r\n    ['Std Status'] = StdStatus,\r\n    ['AHB VMs'] = AHB_VMs,\r\n    ['PAYG VMs'] = PAYG_VMs,\r\n    ['Unknown VMs'] = Unknown_VMs",
        "size": 3,
        "title": "SQL Server Core Consumption (4-Core Minimum Applied)",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Quota Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Over quota",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Within quota",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "info",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SqlServerEnterpriseCorePacks",
        "comparison": "isNotEqualTo",
        "value": "0"
      },
      "customWidth": "100",
      "name": "table-sql-core-utilization"
    },
    {
      "type": 1,
      "content": {
        "json": "## Windows Server virtual machines"
      },
      "name": "header-windows-server"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| extend\r\n    osType = tostring(properties.storageProfile.osDisk.osType),\r\n    licenseType = tostring(properties.licenseType)\r\n| where osType =~ 'Windows'\r\n| join kind=leftouter (\r\n    ResourceContainers\r\n    | where type =~ \"microsoft.resources/subscriptions\"\r\n    | project subscriptionId, subscriptionName = name\r\n) on subscriptionId\r\n| extend\r\n    AHB_Status = iff(licenseType =~ 'Windows_Server', 'AHB enabled', 'AHB not enabled')\r\n| summarize VMCount = count() by subscriptionName, AHB_Status\r\n| order by subscriptionName asc, AHB_Status asc",
        "size": 0,
        "title": "Windows Server virtual machines",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "unstackedbar",
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "subscriptionName",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "VMCount",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "xAxis": "subscriptionName",
          "group": "AHB_Status",
          "createOtherGroup": null,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "AHB not enabled",
              "color": "redBright"
            },
            {
              "seriesName": "AHB enabled",
              "color": "green"
            }
          ]
        }
      },
      "name": "chart-windows-server-vms"
    },
    {
      "type": 1,
      "content": {
        "json": "## SQL Server on Azure Virtual Machines\r\n\r\nThis section shows virtual machines registered with the SQL IaaS Agent extension. VMs running SQL Server that are not registered with the SQL IaaS Agent will not appear here.\r\n\r\nUse this section as a compliance overview for registered SQL Server VMs, not as a complete inventory of all SQL Server installations."
      },
      "name": "header-sql-server-vms"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ \"microsoft.sqlvirtualmachine/sqlvirtualmachines\"\r\n| join kind=leftouter (\r\n    ResourceContainers\r\n    | where type =~ \"microsoft.resources/subscriptions\"\r\n    | project subscriptionId, subscriptionName = name\r\n) on subscriptionId\r\n| extend\r\n    VmResourceId = tostring(properties.virtualMachineResourceId),\r\n    SqlServerLicenseType = tostring(properties.sqlServerLicenseType),\r\n    SqlImageOffer = tostring(properties.sqlImageOffer),\r\n    SqlImageSku = tostring(properties.sqlImageSku)\r\n| extend\r\n    SqlEdition = case(\r\n        isempty(SqlImageSku) and isempty(SqlImageOffer), \"Unknown\",\r\n        strcat(SqlImageOffer, \" \", SqlImageSku)\r\n    ),\r\n    AHB_Status = case(\r\n        SqlServerLicenseType =~ \"AHUB\", \"AHB enabled\",\r\n        SqlServerLicenseType =~ \"PAYG\", \"AHB not enabled\",\r\n        isempty(SqlServerLicenseType), \"AHB unknown\",\r\n        \"AHB unknown\"\r\n    )\r\n| where SqlEdition in ({SqlEditionParam})\r\n| summarize VMCount = dcount(VmResourceId) by subscriptionName, AHB_Status\r\n| order by subscriptionName asc, AHB_Status asc",
        "size": 0,
        "title": "Azure VMs with SQL Server installed",
        "color": "redBright",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "unstackedbar",
        "chartSettings": {
          "xAxis": "subscriptionName",
          "group": "AHB_Status",
          "createOtherGroup": null,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "AHB not enabled",
              "color": "redBright"
            },
            {
              "seriesName": "AHB enabled",
              "color": "green"
            },
            {
              "seriesName": "AHB unknown",
              "color": "yellow"
            }
          ]
        }
      },
      "name": "chart-sql-server-vms"
    },
    {
      "type": 1,
      "content": {
        "json": "## Azure SQL Platform Services"
      },
      "name": "header-azure-sql-platform"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'microsoft.sql/servers/databases'\r\n| join kind=leftouter (\r\n    ResourceContainers\r\n    | where type =~ \"microsoft.resources/subscriptions\"\r\n    | project subscriptionId, subscriptionName = name\r\n) on subscriptionId\r\n| extend\r\n    licenseType = tostring(properties.licenseType)\r\n| extend\r\n    AHB_Status = iff(licenseType =~ 'BasePrice', 'AHB enabled', 'AHB not enabled')\r\n| summarize Count = count() by subscriptionName, AHB_Status\r\n| order by subscriptionName asc, AHB_Status asc",
        "size": 0,
        "title": "Azure SQL Database",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "unstackedbar",
        "chartSettings": {
          "xAxis": "subscriptionName",
          "group": "AHB_Status",
          "createOtherGroup": null,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "AHB not enabled",
              "color": "redBright"
            },
            {
              "seriesName": "AHB enabled",
              "color": "green"
            }
          ]
        }
      },
      "name": "chart-azure-sql-database"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Resources\r\n| where type =~ 'microsoft.sql/managedinstances'\r\n| join kind=leftouter (\r\n    ResourceContainers\r\n    | where type =~ \"microsoft.resources/subscriptions\"\r\n    | project subscriptionId, subscriptionName = name\r\n) on subscriptionId\r\n| extend\r\n    licenseType = tostring(properties.licenseType)\r\n| extend\r\n    AHB_Status = iff(licenseType =~ 'BasePrice', 'AHB enabled', 'AHB not enabled')\r\n| summarize Count = count() by subscriptionName, AHB_Status\r\n| order by subscriptionName asc, AHB_Status asc",
        "size": 0,
        "title": "Azure SQL Managed Instance",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "unstackedbar",
        "chartSettings": {
          "xAxis": "subscriptionName",
          "group": "AHB_Status",
          "createOtherGroup": null,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "AHB not enabled",
              "color": "redBright"
            },
            {
              "seriesName": "AHB enabled",
              "color": "green"
            }
          ]
        }
      },
      "name": "chart-azure-sql-managed-instance"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}